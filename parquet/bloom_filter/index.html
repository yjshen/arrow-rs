<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Bloom filter implementation specific to Parquet, as described in the spec."><title>parquet::bloom_filter - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-5ca6ca2a1f83705a.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="parquet" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0-nightly (7120fdac7 2024-07-25)" data-channel="nightly" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../parquet/index.html">parquet</a><span class="version">52.2.0</span></h2></div><h2 class="location"><a href="#">Module bloom_filter</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate parquet</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">parquet</a>::<wbr><a class="mod" href="#">bloom_filter</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/parquet/bloom_filter/mod.rs.html#18-524">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Bloom filter implementation specific to Parquet, as described
in the <a href="https://github.com/apache/parquet-format/blob/master/BloomFilter.md">spec</a>.</p>
<h2 id="bloom-filter-size"><a class="doc-anchor" href="#bloom-filter-size">Â§</a>Bloom Filter Size</h2>
<p>Parquet uses the <a href="https://arxiv.org/pdf/2101.01719">Split Block Bloom Filter</a> (SBBF) as its bloom filter
implementation. For each column upon which bloom filters are enabled, the offset and length of an SBBF
is stored in  the metadata for each row group in the parquet file. The size of each filter is
initialized using a calculation based on the desired number of distinct values (NDV) and false
positive probability (FPP). The FPP for a SBBF can be approximated as<sup><a href="http://tfk.mit.edu/pdf/bloom.pdf">1</a></sup>:</p>
<div class="example-wrap"><pre class="language-text"><code>f = (1 - e^(-k * n / m))^k
</code></pre></div>
<p>Where, <code>f</code> is the FPP, <code>k</code> the number of hash functions, <code>n</code> the NDV, and <code>m</code> the total number
of bits in the bloom filter. This can be re-arranged to determine the total number of bits
required to achieve a given FPP and NDV:</p>
<div class="example-wrap"><pre class="language-text"><code>m = -k * n / ln(1 - f^(1/k))
</code></pre></div>
<p>SBBFs use eight hash functions to cleanly fit in SIMD lanes<sup><a href="https://arxiv.org/pdf/2101.01719">2</a></sup>, therefore
<code>k</code> is set to 8. The SBBF will spread those <code>m</code> bits accross a set of <code>b</code> blocks that
are each 256 bits, i.e., 32 bytes, in size. The number of blocks is chosen as:</p>
<div class="example-wrap"><pre class="language-text"><code>b = NP2(m/8) / 32
</code></pre></div>
<p>Where, <code>NP2</code> denotes <em>the next power of two</em>, and <code>m</code> is divided by 8 to be represented as bytes.</p>
<p>Here is a table of calculated sizes for various FPP and NDV:</p>
<div><table><thead><tr><th>NDV</th><th>FPP</th><th>b</th><th>Size (KB)</th></tr></thead><tbody>
<tr><td>10,000</td><td>0.1</td><td>256</td><td>8</td></tr>
<tr><td>10,000</td><td>0.01</td><td>512</td><td>16</td></tr>
<tr><td>10,000</td><td>0.001</td><td>1,024</td><td>32</td></tr>
<tr><td>10,000</td><td>0.0001</td><td>1,024</td><td>32</td></tr>
<tr><td>100,000</td><td>0.1</td><td>4,096</td><td>128</td></tr>
<tr><td>100,000</td><td>0.01</td><td>4,096</td><td>128</td></tr>
<tr><td>100,000</td><td>0.001</td><td>8,192</td><td>256</td></tr>
<tr><td>100,000</td><td>0.0001</td><td>16,384</td><td>512</td></tr>
<tr><td>100,000</td><td>0.00001</td><td>16,384</td><td>512</td></tr>
<tr><td>1,000,000</td><td>0.1</td><td>32,768</td><td>1,024</td></tr>
<tr><td>1,000,000</td><td>0.01</td><td>65,536</td><td>2,048</td></tr>
<tr><td>1,000,000</td><td>0.001</td><td>65,536</td><td>2,048</td></tr>
<tr><td>1,000,000</td><td>0.0001</td><td>131,072</td><td>4,096</td></tr>
<tr><td>1,000,000</td><td>0.00001</td><td>131,072</td><td>4,096</td></tr>
<tr><td>1,000,000</td><td>0.000001</td><td>262,144</td><td>8,192</td></tr>
</tbody></table>
</div></div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Block.html" title="struct parquet::bloom_filter::Block">Block</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Each block is 256 bits, broken up into eight contiguous â€œwordsâ€, each consisting of 32 bits.
Each word is thought of as an array of bits; each bit is either â€œsetâ€ or â€œnot setâ€.</div></li><li><div class="item-name"><a class="struct" href="struct.Sbbf.html" title="struct parquet::bloom_filter::Sbbf">Sbbf</a></div><div class="desc docblock-short">A split block Bloom filter. The creation of this structure is based on the
<a href="../file/properties/struct.BloomFilterProperties.html" title="struct parquet::file::properties::BloomFilterProperties"><code>crate::file::properties::BloomFilterProperties</code></a> struct set via <a href="../file/properties/struct.WriterProperties.html" title="struct parquet::file::properties::WriterProperties"><code>crate::file::properties::WriterProperties</code></a> and
is thus hidden by default.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.BITSET_MAX_LENGTH.html" title="constant parquet::bloom_filter::BITSET_MAX_LENGTH">BITSET_MAX_LENGTH</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="constant" href="constant.BITSET_MIN_LENGTH.html" title="constant parquet::bloom_filter::BITSET_MIN_LENGTH">BITSET_MIN_LENGTH</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="constant" href="constant.SALT.html" title="constant parquet::bloom_filter::SALT">SALT</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Salt as defined in the <a href="https://github.com/apache/parquet-format/blob/master/BloomFilter.md#technical-approach">spec</a>.</div></li><li><div class="item-name"><a class="constant" href="constant.SBBF_HEADER_SIZE_ESTIMATE.html" title="constant parquet::bloom_filter::SBBF_HEADER_SIZE_ESTIMATE">SBBF_HEADER_SIZE_ESTIMATE</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="constant" href="constant.SEED.html" title="constant parquet::bloom_filter::SEED">SEED</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.chunk_read_bloom_filter_header_and_offset.html" title="fn parquet::bloom_filter::chunk_read_bloom_filter_header_and_offset">chunk_read_bloom_filter_header_and_offset</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">given an initial offset, and a byte buffer, try to read out a bloom filter header and return
both the header and the offset after it (for bitset).</div></li><li><div class="item-name"><a class="fn" href="fn.hash_as_bytes.html" title="fn parquet::bloom_filter::hash_as_bytes">hash_as_bytes</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.num_of_bits_from_ndv_fpp.html" title="fn parquet::bloom_filter::num_of_bits_from_ndv_fpp">num_of_bits_from_ndv_fpp</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.optimal_num_of_bytes.html" title="fn parquet::bloom_filter::optimal_num_of_bytes">optimal_num_of_bytes</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.read_bloom_filter_header_and_length.html" title="fn parquet::bloom_filter::read_bloom_filter_header_and_length">read_bloom_filter_header_and_length</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">given a [Bytes] buffer, try to read out a bloom filter header and return both the header and
length of the header.</div></li></ul></section></div></main></body></html>