<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Comparing two `GenericByteViewArray` at index `left_idx` and `right_idx`"><title>compare_byte_view_unchecked in arrow_ord::cmp - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-5ca6ca2a1f83705a.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="arrow_ord" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0-nightly (7120fdac7 2024-07-25)" data-channel="nightly" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../arrow_ord/index.html">arrow_ord</a><span class="version">52.2.0</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In arrow_ord::cmp</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../index.html">arrow_ord</a>::<wbr><a href="index.html">cmp</a>::<wbr><a class="fn" href="#">compare_byte_view_unchecked</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/arrow_ord/cmp.rs.html#660-691">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub unsafe fn compare_byte_view_unchecked&lt;T: ByteViewType&gt;(
    left: &amp;GenericByteViewArray&lt;T&gt;,
    left_idx: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>,
    right: &amp;GenericByteViewArray&lt;T&gt;,
    right_idx: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/cmp/enum.Ordering.html" title="enum core::cmp::Ordering">Ordering</a></code></pre><span class="item-info"><div class="stab deprecated"><span class="emoji">ðŸ‘Ž</span><span>Deprecated: Use <code>GenericByteViewArray::compare_unchecked</code> instead</span></div></span><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Comparing two [<code>GenericByteViewArray</code>] at index <code>left_idx</code> and <code>right_idx</code></p>
<p>Comparing two ByteView types are non-trivial.
It takes a bit of patience to understand why we donâ€™t just compare two &amp;<a href="https://doc.rust-lang.org/nightly/std/primitive.u8.html" title="primitive u8">u8</a> directly.</p>
<p>ByteView types give us the following two advantages, and we need to be careful not to lose them:
(1) For string/byte smaller than 12 bytes, the entire data is inlined in the view.
Meaning that reading one array element requires only one memory access
(two memory access required for StringArray, one for offset buffer, the other for value buffer).</p>
<p>(2) For string/byte larger than 12 bytes, we can still be faster than (for certain operations) StringArray/ByteArray,
thanks to the inlined 4 bytes.
Consider equality check:
If the first four bytes of the two strings are different, we can return false immediately (with just one memory access).</p>
<p>If we directly compare two &amp;<a href="https://doc.rust-lang.org/nightly/std/primitive.u8.html" title="primitive u8">u8</a>, we materialize the entire string (i.e., make multiple memory accesses), which might be unnecessary.</p>
<ul>
<li>Most of the time (eq, ord), we only need to look at the first 4 bytes to know the answer,
e.g., if the inlined 4 bytes are different, we can directly return unequal without looking at the full string.</li>
</ul>
<h2 id="order-check-flow"><a class="doc-anchor" href="#order-check-flow">Â§</a>Order check flow</h2>
<p>(1) if both string are smaller than 12 bytes, we can directly compare the data inlined to the view.
(2) if any of the string is larger than 12 bytes, we need to compare the full string.
(2.1) if the inlined 4 bytes are different, we can return the result immediately.
(2.2) o.w., we need to compare the full string.</p>
<h2 id="safety"><a class="doc-anchor" href="#safety">Â§</a>Safety</h2>
<p>The left/right_idx must within range of each array</p>
</div></details></section></div></main></body></html>